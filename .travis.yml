language: node_js
node_js:
- 6  # recommended version
- 8
branches:
  except:
  - gh-pages
  - l10n_develop
addons:
  apt:
    packages:
      - xvfb
  chrome: stable
env:
  global:
    - DISPLAY=:99
before_install:
- rm -rf node_modules
before_script:
- npm install grunt-cli -g
- npm install bower -g
- sh -e /etc/init.d/xvfb start
- sleep 3
script:
- npm test
- npm run frisby
- NODE_ENV=ctf npm run protractor
after_success:
- ./node_modules/.bin/lcov-result-merger 'build/reports/coverage/*/lcov.info' 'build/reports/coverage/lcov_merged.info'
- ./node_modules/.bin/codeclimate-test-reporter < ./build/reports/coverage/lcov_merged.info
before_deploy:
- rm -rf node_modules
- npm install --production
- grunt package
